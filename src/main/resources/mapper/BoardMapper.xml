<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.powernote.skeleton.mapper.BoardMapper">
    <insert id="save" parameterType="com.powernote.skeleton.dto.PostDataDto">
        insert into TB_BOARD_POST ( POST_NO ,  TITLE ,  CONTENT ,  WRITER,  USER_NO, REG_DATE ,  UPT_DATE ) values (
            TB_BOARD_POST_SEQ.NEXTVAL,
            #{title},
            #{content},
            '',
            #{userNo},
            SYSDATE,
            SYSDATE
        )
    </insert>

    <select id="findByWord" parameterType="HashMap" resultType="com.powernote.skeleton.vo.PostDataVo">
<!--        oracle 12 이후 -->
        SELECT POST_NO, TITLE, CONTENT, TU.USER_NAME as WRITER, PO.USER_NO, VIEW_CNT, PO.REG_DATE, PO.UPT_DATE
        FROM TB_BOARD_POST PO
            INNER JOIN TB_USER TU on PO.USER_NO = TU.USER_NO
        <where>
<!--            <if test="title != null">title like  ('%'||#{title}||'%')</if>-->
<!--            <if test="content != null">AND content like ('%'||#{content}||'%')</if>-->
            <if test="title_content != null">AND (title like ('%'||#{title_content}||'%') or content like ('%'||#{title_content}||'%'))</if>
        </where>
        ORDER BY POST_NO desc
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY

<!--        select * from TB_BOARD_POST-->
<!--        <where>-->
<!--            <if test="title != null">title = #{title}</if>-->
<!--            <if test="content != null">AND title like #{content}</if>-->
<!--        </where>-->
<!--        order by post_no desc-->
<!--        limit #{pageSize}-->
<!--        offset #{offset}-->
    </select>

    <select id="findByWordCount" resultType="Integer">
        SELECT count(*) from (
            SELECT *
            FROM TB_BOARD_POST PO
                INNER JOIN TB_USER TU on PO.USER_NO = TU.USER_NO
            <where>
                <!--            <if test="title != null">title like  ('%'||#{title}||'%')</if>-->
                <!--            <if test="content != null">AND content like ('%'||#{content}||'%')</if>-->
                <if test="title_content != null">AND (title like ('%'||#{title_content}||'%') or content like ('%'||#{title_content}||'%'))</if>
            </where>
        )
    </select>

    <select id="findByPostId" parameterType="String" resultType="com.powernote.skeleton.vo.PostDataVo">
        SELECT POST_NO, TITLE, CONTENT, TU.USER_NAME as WRITER, PO.USER_NO, VIEW_CNT, PO.REG_DATE, PO.UPT_DATE
        FROM TB_BOARD_POST PO
            INNER JOIN TB_USER TU on PO.USER_NO = TU.USER_NO
        where POST_NO = #{postNo}
    </select>

    <update id="update" parameterType="com.powernote.skeleton.dto.PostDataDto">
        update TB_BOARD_POST
        set TITLE = #{title},
            CONTENT = #{content},
            UPT_DATE = SYSDATE
        where POST_NO = #{postNo}
    </update>

    <update id="updateViewCnt" parameterType="String">
        update TB_BOARD_POST
        set VIEW_CNT = VIEW_CNT + 1
        where POST_NO = #{postNo}
    </update>

    <update id="delete" parameterType="com.powernote.skeleton.dto.PostDataDto">
        select * from TB_BOARD_POST
    </update>
</mapper>